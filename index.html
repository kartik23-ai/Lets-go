<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Haunted Memory</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  touch-action:none;
  font-family: monospace;
}
canvas{display:block}

/* STORY SCREEN */
#story{
  position:fixed;
  inset:0;
  background:black;
  color:#eee;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:20px;
  z-index:50;
}
#storyText{
  font-size:18px;
  line-height:1.6;
  max-width:500px;
  animation:fade 2s;
}
@keyframes fade{
  from{opacity:0}
  to{opacity:1}
}

/* TAP SCREEN */
#tap{
  margin-top:30px;
  color:#888;
  font-size:14px;
}

/* CONTROLS */
#controls{position:fixed;bottom:20px;left:20px;z-index:10}
#turn{position:fixed;bottom:20px;right:20px}
.btn{
  width:60px;height:60px;border-radius:50%;
  background:rgba(255,255,255,0.25);
  color:white;text-align:center;
  line-height:60px;font-size:24px;
  margin-bottom:10px;user-select:none;
}

/* DANGER BORDER */
#danger{
  position:fixed;
  inset:0;
  border:0 solid red;
  pointer-events:none;
  transition:border 0.2s;
}
</style>
</head>

<body>

<div id="story">
  <div id="storyText"></div>
</div>

<canvas id="game"></canvas>
<div id="danger"></div>

<div id="controls">
  <div class="btn" id="up">▲</div>
  <div class="btn" id="down">▼</div>
</div>

<div id="turn">
  <div class="btn" id="left">⟲</div>
  <div class="btn" id="right">⟳</div>
</div>

<script>
/* ================= STORY ================= */
const storyLines=[
  "This house once belonged to a kind man.",
  "One night, a forbidden ritual took place here.",
  "He tried to stop it… but failed.",
  "His body died, but his soul was trapped.",
  "Now he wanders as a ghost.",
  "His memories are scattered in this house.",
  "Find them… and set him free."
];

let storyIndex=0;
const storyDiv=document.getElementById("story");
const storyText=document.getElementById("storyText");

function showStory(){
  if(storyIndex<storyLines.length){
    storyText.innerHTML=storyLines[storyIndex];
    storyIndex++;
    setTimeout(showStory,2500);
  }else{
    storyText.innerHTML+=
      "<div id='tap'>Tap to enter the house</div>";
    storyDiv.onclick=()=>{
      storyDiv.style.display="none";
      startGame();
    };
  }
}
showStory();

/* ================= GAME ================= */
function startGame(){

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const danger=document.getElementById("danger");

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

/* MAP */
const map=[
 [1,1,1,1,1,1,1,1,1,1,1],
 [1,0,0,0,1,0,0,0,0,0,1],
 [1,0,0,0,1,0,0,0,0,0,1],
 [1,0,0,0,1,0,0,0,0,0,1],
 [1,1,1,0,1,1,1,0,1,1,1],
 [1,0,0,0,0,0,0,0,0,0,1],
 [1,0,0,0,0,0,0,0,0,0,1],
 [1,0,0,0,1,1,1,0,0,0,1],
 [1,0,0,0,1,0,0,0,0,0,1],
 [1,0,0,0,1,0,0,0,0,0,1],
 [1,1,1,1,1,1,1,1,1,1,1],
];

let px=2.5,py=2.5,angle=0;
const ghost={x:9.5,y:9.5,speed:0.003};
const memory={x:5.5,y:5.5,collected:false};

let moveF=false,moveB=false,turnL=false,turnR=false;

up.ontouchstart=()=>moveF=true;
up.ontouchend=()=>moveF=false;
down.ontouchstart=()=>moveB=true;
down.ontouchend=()=>moveB=false;
left.ontouchstart=()=>turnL=true;
left.ontouchend=()=>turnL=false;
right.ontouchstart=()=>turnR=true;
right.ontouchend=()=>turnR=false;

function isWall(x,y){
  return map[Math.floor(y)][Math.floor(x)]===1;
}

function loop(){
  let nx=px,ny=py;
  if(moveF){nx+=Math.cos(angle)*0.05;ny+=Math.sin(angle)*0.05;}
  if(moveB){nx-=Math.cos(angle)*0.05;ny-=Math.sin(angle)*0.05;}
  if(!isWall(nx,ny)){px=nx;py=ny;}
  if(turnL)angle-=0.04;
  if(turnR)angle+=0.04;

  ctx.fillStyle="#111";
  ctx.fillRect(0,0,canvas.width,canvas.height/2);
  ctx.fillStyle="#333";
  ctx.fillRect(0,canvas.height/2,canvas.width,canvas.height/2);

  const fov=Math.PI/3;
  for(let i=0;i<canvas.width;i++){
    const ra=angle-fov/2+fov*i/canvas.width;
    let d=0;
    while(d<20){
      const rx=px+Math.cos(ra)*d;
      const ry=py+Math.sin(ra)*d;
      if(isWall(rx,ry))break;
      d+=0.05;
    }
    const h=canvas.height/(d+0.1);
    const shade=160/d;
    ctx.fillStyle=`rgb(${shade},${shade*0.8},${shade*0.6})`;
    ctx.fillRect(i,canvas.height/2-h/2,1,h);
  }

  const dx=px-ghost.x,dy=py-ghost.y;
  const dist=Math.hypot(dx,dy);
  ghost.x+=dx/dist*ghost.speed;
  ghost.y+=dy/dist*ghost.speed;

  danger.style.border=dist<2?"8px solid red":"0";

  requestAnimationFrame(loop);
}
loop();
}
</script>

</body>
</html>
